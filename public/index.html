<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body class="container pt-6">

<div class="row justify-content-md-center" style="align-items: center">
    <div class="col-sm-12 align-items-center justify-content-center">
        <h1>Jogo de adivinhação de palavras</h1>
    </div>
</div>

<div class="row d-flex">
    <div class="col-sm-4 align-items-center">
        <p id="user">Você</p>
    </div>
    <div class="col-sm-4"></div>
    <div class="col-sm-4 align-items-center">
        <p id="opponent">Oponente</p>
    </div>
</div>
<div>
</div>

<div id="welcome">
    <div>
        <label for="name" id="name_label">Digite seu nome</label>
        <input type="text" placeholder="Nome" id="name">
    </div>

    <button id="search_player" class="btn btn-info">Procurar jogador</button>
    <img id="loading_indicator" src="loading.gif" alt="loading" width="20" height="20">
</div>


<div id="game">
    <p>Seu chute foi:
    <p id="guess_tittle">Chute</p> </p>

    <p>Dicas</p>

    <div id="tips">

    </div>

    <label for="guess">Palpite da palavra</label>
    <input id="guess" type="text" placeholder="Seu chute">
    <button id="submit_guess">Enviar palpite</button>
</div>

</body>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="socket.io/socket.io.js"></script>
<script>

    const socket = io()

    function hide_welcome() {
        $("#welcome").hide()
    }

    function hide_game() {
        $("#game").hide()
        $("#loading_indicator").hide()
    }
    function show_game() {
        $("#game").show()
        $("#loading_indicator").hide()
    }


    function reset_page() {
        $("#guess_tittle").text("Chute")
        $("#guess").val("")
        $("#name").val("")
        $("#user").text("Você")
        $("#opponent").text("Oponente")
    }

    $(document).ready(function () {
        reset_page()
        hide_game()


        socket.on('start_game', function (data) {
            const {tip, players} = data
            hide_welcome()
            $("#opponent").text(players.map(p => p.name).filter(n => n !== $("#name").val()))
            $("#tips").append(`<p>${tip}</p>`)
            show_game()
        })

        socket.on('correct_guess', function (data) {
            alert(`${data} acertou! O jogo foi resetado`)
            reset_page()
        })

        socket.on('tip', function (data) {
            console.log(data)
            const {tip} = data
            if (tip === null)
                return

            console.log(tip)
            $("#tips").append(`<p>${tip}</p>`)
        })
    })


    $("#search_player").click(function () {
        $("#loading_indicator").show()
        let name = $("#name").val()

        if (name === "") {
            alert("Digite seu nome")
            return
        }

        socket.emit('search_player', name);

        $("#user").text("Você" + name)
    })

    $("#submit_guess").click(function () {
        let guess = $("#guess").val()
        $("#guess_tittle").text(guess)
        socket.emit('guess', {guess: guess, name: $("#name").val()})
    })



</script>
</html>