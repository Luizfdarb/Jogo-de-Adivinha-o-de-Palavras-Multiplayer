<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jogo de Adivinhação de Palavras</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body class="container pt-6">
<div class="row align-items-center justify-content-center my-4">
    <h1>Jogo de adivinhação de palavras</h1>
</div>

<div class="row d-flex">
    <div class="col-sm-4 align-items-center">
        <p id="user">Você: </p>
    </div>
    <div class="col-sm-4"></div>
    <div class="col-sm-4 align-items-center">
        <p id="opponent">Oponente: </p>
    </div>
</div>

<div id="welcome">
    <div class="form-group">
        <label for="name" id="name_label">Digite seu nome</label>
        <input type="text" placeholder="Nome" id="name" class="form-control">
    </div>

    <button id="search_player" class="btn btn-info w-100">Procurar jogador</button>
    <div class="row align-items-center justify-content-center my-4">
        <img id="loading_indicator" src="loading.gif" alt="loading" width="50" height="50">
    </div>
</div>

<div id="game">
    <div class="row">
        <div class="col">
            <b>Tentativas(max 6):</b>
            <p id="attempts">0</p>

            <b>Seu palpite foi:</b>
            <p id="guess_tittle">Chute</p>

            <div class="form-group">
                <label for="guess"><b>Palpite da palavra</b></label>
                <input id="guess" type="text" placeholder="Seu chute" class="form-control">
            </div>

            <button id="submit_guess" class="btn btn-primary w-100">Enviar palpite</button>

            <div id="information">Aguarde o turno do oponente acabar</div>
        </div>

        <div class="col">
            <b>Dicas</b>
            <div class="card" style="width: 18rem;">
                <ul id="tips" class="list-group list-group-flush"></ul>
            </div>
        </div>

        <div class="col">
            <b>Tempo Restante</b>
            <p id="timer">Tempo restante: 60 segundos</p>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="disconectModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Aviso</h5>
                    </div>
                    <div class="modal-body">
                        Infelizmente seu oponente se desconectou :(
                    </div>
                    <div class="modal-footer">
                        <button id="close_modal" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="winModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel2">Aviso</h5>
                    </div>
                    <div class="modal-body" id="winModalBody"></div>
                    <div class="modal-footer">
                        <button id="close_win_modal" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="socket.io/socket.io.js"></script>
<script>

    const socket = io();
    let timer;

    function hide_welcome() {
        $("#welcome").hide()
    }

    function hide_game() {
        $("#game").hide();
        $("#loading_indicator").hide();
    }

    function show_game() {
        $("#game").show();
        $("#loading_indicator").hide();
    }

    function disable_guess() {
        $("#guess").prop('disabled', true)
        $("#guess").val("")
        $("#submit_guess").prop('disabled', true)
        $("#information").show()

    }

    function enable_guess() {
        $("#guess").prop('disabled', false)
        $("#submit_guess").prop('disabled', false)
        $("#information").hide()
    }

    $(document).ready(function () {
        hide_game();

        socket.on('start_game', function (data) {
<<<<<<< master
            const {tip, players, whoIsPlaying} = data
            hide_welcome()

            $("#opponent").text("Oponente: " + players.filter(n => n !== $("#name").val()))
            $("#tips").append(`<li class="list-group-item">${($("#tips").children().length + 1) + " - " + tip}</li>`)
            show_game()

            if (whoIsPlaying === $("#name").val()) {
                enable_guess()
            }else{
                disable_guess()
            }
        })
=======
            const {tip, players, gameId} = data;
            hide_welcome();

            $("#opponent").text("Oponente: " + players.filter(n => n !== $("#name").val()));
            $("#tips").append(`<li class="list-group-item">${($("#tips").children().length + 1) + " - " + tip}</li>`);
            show_game();

            let timeLeft = 60; // 1 minuto em segundos

            timer = setInterval(function() {
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    socket.emit('time_up', {gameId: gameId});
                } else {
                    timeLeft--;
                    $("#timer").text(`Tempo restante: ${timeLeft} segundos`);
                }
            }, 1000);
        });
>>>>>>> master

        socket.on("game_started", function (msg) {
            alert("O jogo já começou, aguarde os players terminarem.")
        })

        socket.on('correct_guess', function (data) {
            $("#winModal").modal('show')
            $("#winModalBody").text("O jogador " + data.player + " acertou a palavra, que era: " + data.guess)
        })

        socket.on('tip', function (data) {
            const {tip} = data
            if (tip === null)
                return

            $("#tips").append(`<li class="list-group-item">${($("#tips").children().length + 1) + " - " + tip}</li>`)
        })

        window.addEventListener('beforeunload', function() {
            socket.emit('disconnect', { user: $("#name").val() });
        });

        socket.on('user_disconnected', function (data) {
<<<<<<< master
            console.log("Usuário desconectou")
            $("#disconectModal").modal('show')
        })

        socket.on('invalid_user', function (data) {
            alert("Você não tem permissão para jogar, espere o jogo terminar")

            location.reload()
        })

        socket.on('game_over', function (data) {
            const {player, word} = data
            let message  = "O jogo acabou, o jogador " + player + ` esgotou as tentativas. \n Você ${player !== $("#name").val() ? "ganhou" : "perdeu"}. A palavra era: ${word}`

            $("#winModal").modal('show')
            $("#winModalBody").text(message)
        })

        socket.on('turn', function (data) {
            const {whoIsPlaying} = data
            console.log(whoIsPlaying)
            if (whoIsPlaying === $("#name").val()) {
                enable_guess()
            }else{
                disable_guess()
            }
        })
    })

=======
            $("#disconectModal").modal('show');
        });

        socket.on('invalid_user', function (data) {
            alert("Você não tem permissão para jogar, espere o jogo terminar");
            location.reload();
        });
    });
>>>>>>> master

    $("#search_player").click(function () {
        let name = $("#name").val()
        if (name === "") {
            alert("Digite seu nome")
            return
        }

        $("#loading_indicator").show()


        socket.emit('search_player', name);

        $("#user").text("Você: " + name)
    })


    $("#submit_guess").click(function () {
        let guess = $("#guess").val()
        $("#guess_tittle").text(guess)
        socket.emit('guess', {guess: guess, name: $("#name").val()})
        let attempts = parseInt($("#attempts").text())
        $("#attempts").text(attempts + 1)
    })

    $("#close_modal").on('click', function () {
        $("#exampleModal").modal('hide')
        location.reload()
    })

    $("#exampleModal").on('hidden.bs.modal', function () {
        location.reload()
    })

    $("#close_win_modal").on('click', function () {
        $("#winModal").modal('hide')
        location.reload()
    })

    $("#winModal").on('hidden.bs.modal', function () {
        location.reload()
    })
</script>
</html>